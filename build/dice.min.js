dice={version:"0.2.0",roll:function(t,m){var d=dice.parse.parse(t);return dice.eval.eval(d,m)}};
dice.parse=function(){function t(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var m={parse:function(d,l){function b(a){var c={},b;for(b in a)c[b]=a[b];return c}function g(a,c){for(var b=a.offset+c,h=a.offset;h<b;h++){var g=d.charAt(h);"\n"===g?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===g||"\u2028"===g||"\u2029"===
g?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=c}function e(a){c.offset<u.offset||(c.offset>u.offset&&(u=b(c),w=[]),w.push(a))}function p(){var a,f,d,h;h=b(c);a=x();null!==a?(f=m(),null!==f?(d=p(),null!==d?a=[a,f,d]:(a=null,c=b(h))):(a=null,c=b(h))):(a=null,c=b(h));null===a&&(a=x());return a}function x(){var a,f,d,h,g;h=b(c);g=b(c);a=v();null!==a?(f=y(),null!==f?(d=q(),null!==d?a=[a,f,d]:(a=null,c=b(g))):(a=null,c=b(g))):(a=null,c=b(g));null!==a&&(a={x:a[0],mode:a[1],min:a[2].min,
max:a[2].max});null===a&&(c=b(h));null===a&&(h=b(c),g=b(c),a=y(),null!==a?(f=q(),null!==f?a=[a,f]:(a=null,c=b(g))):(a=null,c=b(g)),null!==a&&(a={x:1,mode:a[0],min:a[1].min,max:a[1].max}),null===a&&(c=b(h)),null===a&&(h=b(c),a=v(),null!==a&&(a={x:1,mode:"d",min:a,max:a}),null===a&&(c=b(h)),null===a&&(h=b(c),a=q(),null!==a&&(a={x:1,mode:"d",min:a.min,max:a.max}),null===a&&(c=b(h)))));return a}function y(){var a;100===d.charCodeAt(c.offset)?(a="d",g(c,1)):(a=null,0===n&&e('"d"'));null===a&&(119===d.charCodeAt(c.offset)?
(a="w",g(c,1)):(a=null,0===n&&e('"w"')));return a}function q(){var a,f,k,h,r;h=b(c);r=b(c);a=v();null!==a?(".."===d.substr(c.offset,2)?(f="..",g(c,2)):(f=null,0===n&&e('".."')),null!==f?(k=v(),null!==k?a=[a,f,k]:(a=null,c=b(r))):(a=null,c=b(r))):(a=null,c=b(r));null!==a&&(a={min:a[0],max:a[2]});null===a&&(c=b(h));null===a&&(h=b(c),a=v(),null!==a&&(a={min:1,max:a}),null===a&&(c=b(h)));return a}function m(){var a,f,k,h,r;h=b(c);r=b(c);a=z();null!==a?(/^[+\-]/.test(d.charAt(c.offset))?(f=d.charAt(c.offset),
g(c,1)):(f=null,0===n&&e("[+\\-]")),null!==f?(k=z(),null!==k?a=[a,f,k]:(a=null,c=b(r))):(a=null,c=b(r))):(a=null,c=b(r));null!==a&&(a=a[1]);null===a&&(c=b(h));return a}function z(){var a,b;a=[];/^[ ]/.test(d.charAt(c.offset))?(b=d.charAt(c.offset),g(c,1)):(b=null,0===n&&e("[ ]"));for(;null!==b;)a.push(b),/^[ ]/.test(d.charAt(c.offset))?(b=d.charAt(c.offset),g(c,1)):(b=null,0===n&&e("[ ]"));return a}function v(){var a,d;d=b(c);a=A();null!==a&&(a=function(a,b,c,d){return function(){return d}}(d.offset,
d.line,d.column,a));null===a&&(c=b(d));null===a&&(d=b(c),a=B(),null!==a&&(a=function(a,b,c,d){return function(a){return a[d]}}(d.offset,d.line,d.column,a)),null===a&&(c=b(d)));return a}function B(){var a,f,k,h,p;h=b(c);p=b(c);91===d.charCodeAt(c.offset)?(a="[",g(c,1)):(a=null,0===n&&e('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(d.charAt(c.offset))?(k=d.charAt(c.offset),g(c,1)):(k=null,0===n&&e("[a-zA-Z 0-9]"));if(null!==k)for(f=[];null!==k;)f.push(k),/^[a-zA-Z 0-9]/.test(d.charAt(c.offset))?(k=d.charAt(c.offset),
g(c,1)):(k=null,0===n&&e("[a-zA-Z 0-9]"));else f=null;null!==f?(93===d.charCodeAt(c.offset)?(k="]",g(c,1)):(k=null,0===n&&e('"]"')),null!==k?a=[a,f,k]:(a=null,c=b(p))):(a=null,c=b(p))}else a=null,c=b(p);null!==a&&(a=a[1].join(""));null===a&&(c=b(h));return a}function A(){var a,f,k;n++;k=b(c);/^[0-9]/.test(d.charAt(c.offset))?(f=d.charAt(c.offset),g(c,1)):(f=null,0===n&&e("[0-9]"));if(null!==f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(d.charAt(c.offset))?(f=d.charAt(c.offset),g(c,1)):(f=null,0===
n&&e("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(c=b(k));n--;0===n&&null===a&&e("integer");return a}function D(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var s={dicerolls:p,diceroll:x,rollmode:y,minmax:q,operation:m,ws:z,intval:v,variable:B,integer:A};if(void 0!==l){if(void 0===s[l])throw Error("Invalid rule name: "+t(l)+".");}else l="dicerolls";var c={offset:0,line:1,column:1,seenCR:!1},n=0,u={offset:0,line:1,column:1,seenCR:!1},
w=[],s=s[l]();if(null===s||c.offset!==d.length){var s=Math.max(c.offset,u.offset),E=s<d.length?d.charAt(s):null,C=c.offset>u.offset?c:u;throw new this.SyntaxError(D(w),E,s,C.line,C.column);}return s},toSource:function(){return this._source},SyntaxError:function(d,l,b,g,e){this.name="SyntaxError";this.expected=d;this.found=l;switch(d.length){case 0:d="end of input";break;case 1:d=d[0];break;default:d=d.slice(0,d.length-1).join(", ")+" or "+d[d.length-1]}l=l?t(l):"end of input";this.message="Expected "+
d+" but "+l+" found.";this.offset=b;this.line=g;this.column=e}};m.SyntaxError.prototype=Error.prototype;return m}();
dice.eval=function(){var t=function(b,d){return b+d},m=function(b){1==b.min&&(b.min=function(){return 1});1==b.x&&(b.x=function(){return 1});return b},d=function(b,d){if("+"==d||"-"==d)return b.mode=d,b;var e=l(d,b.scope),p=e.reduce(t);b.rolls=b.rolls.concat(e);"+"==b.mode?b.sum+=p:"-"==b.mode&&(b.sum-=p);return b},l=function(b,d){b=m(b);var e=b.x(d);return 0===e?[0]:_.range(0,e).map(function(){var e;e=b.min(d);var l=b.max(d),m=b.mode;if(e==l)e=l;else{var q=_.random(e,l);if("d"==m)e=q;else{for(m=
q;q==l;)q=_.random(e,l),m+=q;e=m}}return e})};return{eval:function(b,g){g=g||{};var e=b;e instanceof Array||(e=[e]);b=_.flatten(e);e=b.reduce(d,{sum:0,mode:"+",rolls:[],scope:g});return{sum:e.sum,rolls:e.rolls}}}}();
