dice={version:"0.4.0",roll:function(n,r){var d=dice.parse.parse(n);return dice.eval.eval(d,r)},stringify_op:function(n){var r=dice.stringify(n.rightSide),d=dice.stringify(n.leftSide);return r+" "+n.op+" "+d},stringify_rolls:function(n){return n.x+n.mode+(1<n.min?n.min+"..":"")+n.max+":["+n.rolls.join(", ")+"]"},stringify:function(n){return n.op?dice.stringify_op(n):n.rolls?dice.stringify_rolls(n):n.toString()}};
dice.parse=function(){function n(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var r={parse:function(d,s){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function k(a,b){for(var c=a.offset+b,f=a.offset;f<c;f++){var h=d.charAt(f);"\n"===h?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===h||"\u2028"===h||"\u2029"===
h?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=b}function l(a){b.offset<w.offset||(b.offset>w.offset&&(w=c(b),z=[]),z.push(a))}function m(){var a,e,g,f,h;f=c(b);h=c(b);a=q();null!==a?(e=A(),null!==e?(g=y(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(f));null===a&&(f=c(b),a=y(),null===a&&(b=c(f)),null===a&&(f=c(b),a=r(),null===a&&(b=c(f))));return a}function r(){var a,e,g,f,h,s,n;s=c(b);n=c(b);
40===d.charCodeAt(b.offset)?(a="(",k(b,1)):(a=null,0===p&&l('"("'));null!==a?(e=t(),null!==e?(g=m(),null!==g?(f=t(),null!==f?(41===d.charCodeAt(b.offset)?(h=")",k(b,1)):(h=null,0===p&&l('")"')),null!==h?a=[a,e,g,f,h]:(a=null,b=c(n))):(a=null,b=c(n))):(a=null,b=c(n))):(a=null,b=c(n))):(a=null,b=c(n));null!==a&&(a={op:"parenExpress",args:[rolsl]});null===a&&(b=c(s));return a}function v(){var a,e,g,f,h;f=c(b);h=c(b);a=t();null!==a?(42===d.charCodeAt(b.offset)?(e="*",k(b,1)):(e=null,0===p&&l('"*"')),
null!==e?(g=t(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a="*");null===a&&(b=c(f));null===a&&(f=c(b),h=c(b),a=t(),null!==a?(47===d.charCodeAt(b.offset)?(e="/",k(b,1)):(e=null,0===p&&l('"/"')),null!==e?(g=t(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a="/"),null===a&&(b=c(f)));return a}function q(){var a,e,g,f,h;f=c(b);h=c(b);a=B();null!==a?(e=v(),null!==e?(g=q(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,
b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(f));null===a&&(f=c(b),a=B(),null===a&&(b=c(f)));return a}function y(){var a,e,g,f,h;f=c(b);h=c(b);a=q();null!==a?(e=A(),null!==e?(g=y(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(f));null===a&&(f=c(b),a=q(),null===a&&(b=c(f)));return a}function A(){var a,e,g,f,h;f=c(b);h=c(b);a=t();null!==a?(43===d.charCodeAt(b.offset)?(e="+",k(b,1)):(e=null,0===p&&l('"+"')),
null!==e?(g=t(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a="+");null===a&&(b=c(f));null===a&&(f=c(b),h=c(b),a=t(),null!==a?(45===d.charCodeAt(b.offset)?(e="-",k(b,1)):(e=null,0===p&&l('"-"')),null!==e?(g=t(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a="-"),null===a&&(b=c(f)));return a}function B(){var a,e,g,f,h;f=c(b);h=c(b);a=x();null!==a?(e=C(),null!==e?(g=D(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,
b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(f));null===a&&(f=c(b),h=c(b),a=C(),null!==a?(e=D(),null!==e?a=[a,e]:(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a={op:a[0],args:[1,a[1]]}),null===a&&(b=c(f)),null===a&&(f=c(b),a=E(),null!==a&&(a={op:"d",args:[{op:"static",value:1},a]}),null===a&&(b=c(f)),null===a&&(f=c(b),a=x(),null===a&&(b=c(f)))));return a}function C(){var a;100===d.charCodeAt(b.offset)?(a="d",k(b,1)):(a=null,0===p&&l('"d"'));null===a&&(119===d.charCodeAt(b.offset)?
(a="w",k(b,1)):(a=null,0===p&&l('"w"')));return a}function D(){var a,e;e=c(b);a=E();null===a&&(b=c(e));null===a&&(e=c(b),a=x(),null!==a&&(a={op:"random",args:[{op:"static",args:[],value:1},a]}),null===a&&(b=c(e)));return a}function E(){var a,e,g,f,h;f=c(b);h=c(b);a=x();null!==a?(".."===d.substr(b.offset,2)?(e="..",k(b,2)):(e=null,0===p&&l('".."')),null!==e?(g=x(),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:"random",args:[a[0],a[2]]});null===a&&(b=c(f));return a}
function t(){var a,c;a=[];/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),k(b,1)):(c=null,0===p&&l("[ ]"));for(;null!==c;)a.push(c),/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),k(b,1)):(c=null,0===p&&l("[ ]"));return a}function x(){var a,e,g,f;g=c(b);a=H();null!==a&&(a={op:"static",value:a});null===a&&(b=c(g));null===a&&(g=c(b),a=F(),null===a&&(b=c(g)),null===a&&(g=c(b),f=c(b),a=G(),null!==a?(e=F(),null!==e?a=[a,e]:(a=null,b=c(f))):(a=null,b=c(f)),null!==a&&(a={op:a[0],args:[a[1]]}),
null===a&&(b=c(g)),null===a&&(g=c(b),f=c(b),a=G(),null!==a?(e=r(),null!==e?a=[a,e]:(a=null,b=c(f))):(a=null,b=c(f)),null!==a&&(a={op:a[0]+"_express",args:[a[1]]}),null===a&&(b=c(g)))));return a}function G(){var a,e;e=c(b);102===d.charCodeAt(b.offset)?(a="f",k(b,1)):(a=null,0===p&&l('"f"'));null!==a&&(a="floor");null===a&&(b=c(e));null===a&&(e=c(b),114===d.charCodeAt(b.offset)?(a="r",k(b,1)):(a=null,0===p&&l('"r"')),null!==a&&(a="round"),null===a&&(b=c(e)),null===a&&(e=c(b),99===d.charCodeAt(b.offset)?
(a="c",k(b,1)):(a=null,0===p&&l('"c"')),null!==a&&(a="ceil"),null===a&&(b=c(e))));return a}function F(){var a,e;e=c(b);a=I();null!==a&&(a={op:"lookup",value:a});null===a&&(b=c(e));return a}function I(){var a,e,g,f,h;f=c(b);h=c(b);91===d.charCodeAt(b.offset)?(a="[",k(b,1)):(a=null,0===p&&l('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),k(b,1)):(g=null,0===p&&l("[a-zA-Z 0-9]"));if(null!==g)for(e=[];null!==g;)e.push(g),/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=
d.charAt(b.offset),k(b,1)):(g=null,0===p&&l("[a-zA-Z 0-9]"));else e=null;null!==e?(93===d.charCodeAt(b.offset)?(g="]",k(b,1)):(g=null,0===p&&l('"]"')),null!==g?a=[a,e,g]:(a=null,b=c(h))):(a=null,b=c(h))}else a=null,b=c(h);null!==a&&(a=a[1].join(""));null===a&&(b=c(f));return a}function H(){var a,e,g,f,h;p++;f=c(b);/^[0-9]/.test(d.charAt(b.offset))?(e=d.charAt(b.offset),k(b,1)):(e=null,0===p&&l("[0-9]"));if(null!==e)for(a=[];null!==e;)a.push(e),/^[0-9]/.test(d.charAt(b.offset))?(e=d.charAt(b.offset),
k(b,1)):(e=null,0===p&&l("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(b=c(f));if(null===a){f=c(b);h=c(b);45===d.charCodeAt(b.offset)?(a="-",k(b,1)):(a=null,0===p&&l('"-"'));if(null!==a){/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),k(b,1)):(g=null,0===p&&l("[0-9]"));if(null!==g)for(e=[];null!==g;)e.push(g),/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),k(b,1)):(g=null,0===p&&l("[0-9]"));else e=null;null!==e?a=[a,e]:(a=null,b=c(h))}else a=null,b=c(h);null!==
a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(b=c(f))}p--;0===p&&null===a&&l("integer");return a}function K(a){a.sort();for(var b=null,c=[],f=0;f<a.length;f++)a[f]!==b&&(c.push(a[f]),b=a[f]);return c}var u={dicerolls:m,parenExpress:r,multiplicationOp:v,multiplicationSeq:q,additionSeq:y,additionOp:A,diceroll:B,rollmode:C,maybe_minmax:D,minmax:E,ws:t,intval:x,mathit:G,lookup:F,variable:I,integer:H};if(void 0!==s){if(void 0===u[s])throw Error("Invalid rule name: "+n(s)+".");}else s="dicerolls";var b=
{offset:0,line:1,column:1,seenCR:!1},p=0,w={offset:0,line:1,column:1,seenCR:!1},z=[],u=u[s]();if(null===u||b.offset!==d.length){var u=Math.max(b.offset,w.offset),L=u<d.length?d.charAt(u):null,J=b.offset>w.offset?b:w;throw new this.SyntaxError(K(z),L,u,J.line,J.column);}return u},toSource:function(){return this._source},SyntaxError:function(d,s,c,k,l){this.name="SyntaxError";this.expected=d;this.found=s;switch(d.length){case 0:d="end of input";break;case 1:d=d[0];break;default:d=d.slice(0,d.length-
1).join(", ")+" or "+d[d.length-1]}s=s?n(s):"end of input";this.message="Expected "+d+" but "+s+" found.";this.offset=c;this.line=k;this.column=l}};r.SyntaxError.prototype=Error.prototype;return r}();
dice.eval=function(){function n(d){var c=[];c[d]=!0;for(d=0;d<c.length;d++)c[d]=!0;return c}function r(s){var c;c=(c=s.args)||[];c=c.map(r);return d[s.op].apply(s,c)}var d={"static":function(){var d=this.value;return function(){return d}},lookup:function(){var d=this.value;return function(c){return c[d]}},floor:function(d){return function(c){return Math.floor(d(c))}},ceil:function(d){return function(c){return Math.ceil(d(c))}},round:function(d){return function(c){return Math.round(d(c))}},d:function(d,
c){return function(k){var l=d(k),m,r,v=n(l-1).map(function(){var d=c(k);m=d.min;r=d.max;return d}),q=v.reduce(function(c,d){return c+d},0),q=new Number(q);q.rolls=v;q.min=m;q.max=r;q.x=l;q.mode="d";return q}},w:function(d,c){return function(k){var l=d(k),m,r,v=n(l-1).map(function(){var d=c(k),l=0;m=c.min;r=c.max;if(c.min===c.max)return d;for(;d===c.max;)l+=d,d=mimMax(k);return l}),q=v.reduce(function(c,d){return c+d},0),q=new Number(q);q.rolls=v;q.min=m;q.max=r;q.x=l;q.mode="w";return q}},random:function(d,
c){return function(k){var l=Math.random(),m=c(k);k=d(k);l=Math.round((m-k)*l+k);l=new Number(l);l.min=k;l.max=m;return l}},"+":function(d,c){return function(k){var l=d(k);k=c(k);var m;m=new Number(l+k);m.op="+";m.rightSide=l;m.leftSide=k;return m}},"-":function(d,c){return function(k){var l=d(k);k=c(k);var m;m=new Number(l-k);m.op="-";m.rightSide=l;m.leftSide=k;return m}},"*":function(d,c){return function(k){var l=d(k);k=c(k);var m;m=new Number(l*k);m.op="*";m.rightSide=l;m.leftSide=k;return m}},
"/":function(d,c){return function(k){var l=d(k);k=c(k);var m;m=new Number(l/k);m.op="/";m.rightSide=l;m.leftSide=k;return m}}};return{eval:function(d,c){c=c||{};return r(d)(c)},ops:d}}();
