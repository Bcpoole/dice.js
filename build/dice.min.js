dice={version:"0.3.0",roll:function(u,p){var e=dice.parse.parse(u);return dice.eval.eval(e,p)}};
dice.parse=function(){function u(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var p={parse:function(e,n){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function l(a,b){for(var c=a.offset+b,g=a.offset;g<c;g++){var k=e.charAt(g);"\n"===k?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===k||"\u2028"===k||"\u2029"===
k?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=b}function h(a){b.offset<v.offset||(b.offset>v.offset&&(v=c(b),y=[]),y.push(a))}function s(){var a,f,d,g;g=c(b);a=z();null!==a?(f=A(),null!==f?(d=s(),null!==d?a=[a,f,d]:(a=null,b=c(g))):(a=null,b=c(g))):(a=null,b=c(g));null===a&&(a=z());return a}function z(){var a,f,d,g,k;g=c(b);k=c(b);a=w();null!==a?(f=q(),null!==f?(d=p(),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))):(a=null,b=c(k));null!==a&&(a={x:a[0],mode:a[1],min:a[2].min,
max:a[2].max});null===a&&(b=c(g));null===a&&(g=c(b),k=c(b),a=q(),null!==a?(f=p(),null!==f?a=[a,f]:(a=null,b=c(k))):(a=null,b=c(k)),null!==a&&(a={x:1,mode:a[0],min:a[1].min,max:a[1].max}),null===a&&(b=c(g)),null===a&&(g=c(b),a=w(),null!==a&&(a={x:1,mode:"d",min:a,max:a}),null===a&&(b=c(g)),null===a&&(g=c(b),a=p(),null!==a&&(a={x:1,mode:"d",min:a.min,max:a.max}),null===a&&(b=c(g)))));return a}function q(){var a;100===e.charCodeAt(b.offset)?(a="d",l(b,1)):(a=null,0===m&&h('"d"'));null===a&&(119===e.charCodeAt(b.offset)?
(a="w",l(b,1)):(a=null,0===m&&h('"w"')));return a}function p(){var a,f,d,g,k;g=c(b);k=c(b);a=w();null!==a?(".."===e.substr(b.offset,2)?(f="..",l(b,2)):(f=null,0===m&&h('".."')),null!==f?(d=w(),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))):(a=null,b=c(k));null!==a&&(a={min:a[0],max:a[2]});null===a&&(b=c(g));null===a&&(g=c(b),a=w(),null!==a&&(a={min:1,max:a}),null===a&&(b=c(g)));return a}function A(){var a,f,d,g,k;g=c(b);k=c(b);a=t();null!==a?(/^[+\-]/.test(e.charAt(b.offset))?(f=e.charAt(b.offset),
l(b,1)):(f=null,0===m&&h("[+\\-]")),null!==f?(d=t(),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))):(a=null,b=c(k));null!==a&&(a=a[1]);null===a&&(b=c(g));null===a&&(g=c(b),k=c(b),a=t(),null!==a?(42===e.charCodeAt(b.offset)?(f="*",l(b,1)):(f=null,0===m&&h('"*"')),null!==f?(d=t(),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))):(a=null,b=c(k)),null!==a&&(a="*"),null===a&&(b=c(g)),null===a&&(g=c(b),k=c(b),a=t(),null!==a?(47===e.charCodeAt(b.offset)?(f="/",l(b,1)):(f=null,0===m&&h('"/"')),null!==
f?(d=t(),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))):(a=null,b=c(k)),null!==a&&(a="/"),null===a&&(b=c(g))));return a}function t(){var a,c;a=[];/^[ ]/.test(e.charAt(b.offset))?(c=e.charAt(b.offset),l(b,1)):(c=null,0===m&&h("[ ]"));for(;null!==c;)a.push(c),/^[ ]/.test(e.charAt(b.offset))?(c=e.charAt(b.offset),l(b,1)):(c=null,0===m&&h("[ ]"));return a}function w(){var a,f,d,g;d=c(b);a=B();null!==a&&(a=function(a,b,c,d){a=function(){return d};a.static=!0;return a}(d.offset,d.line,d.column,a));
null===a&&(b=c(d));null===a&&(d=c(b),a=x(),null!==a&&(a=function(a,b,c,d){a=function(a){return a[d]};a.static=!1;a.variable=d;a.operation="none";return a}(d.offset,d.line,d.column,a)),null===a&&(b=c(d)),null===a&&(d=c(b),g=c(b),102===e.charCodeAt(b.offset)?(a="f",l(b,1)):(a=null,0===m&&h('"f"')),null!==a?(f=x(),null!==f?a=[a,f]:(a=null,b=c(g))):(a=null,b=c(g)),null!==a&&(a=function(a,b,c,d){a=function(a){return Math.floor(a[d])};a.static=!1;a.variable=d;a.operation="floor";return a}(d.offset,d.line,
d.column,a[1])),null===a&&(b=c(d)),null===a&&(d=c(b),g=c(b),114===e.charCodeAt(b.offset)?(a="r",l(b,1)):(a=null,0===m&&h('"r"')),null!==a?(f=x(),null!==f?a=[a,f]:(a=null,b=c(g))):(a=null,b=c(g)),null!==a&&(a=function(a,b,c,d){a=function(a){return Math.round(a[d])};a.static=!1;a.variable=d;a.operation="round";return a}(d.offset,d.line,d.column,a[1])),null===a&&(b=c(d)),null===a&&(d=c(b),g=c(b),99===e.charCodeAt(b.offset)?(a="c",l(b,1)):(a=null,0===m&&h('"c"')),null!==a?(f=x(),null!==f?a=[a,f]:(a=null,
b=c(g))):(a=null,b=c(g)),null!==a&&(a=function(a,b,c,d){a=function(a){return Math.ceil(a[d])};a.static=!1;a.variable=d;a.operation="ceiling";return a}(d.offset,d.line,d.column,a[1])),null===a&&(b=c(d))))));return a}function x(){var a,f,d,g,k;g=c(b);k=c(b);91===e.charCodeAt(b.offset)?(a="[",l(b,1)):(a=null,0===m&&h('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(e.charAt(b.offset))?(d=e.charAt(b.offset),l(b,1)):(d=null,0===m&&h("[a-zA-Z 0-9]"));if(null!==d)for(f=[];null!==d;)f.push(d),/^[a-zA-Z 0-9]/.test(e.charAt(b.offset))?
(d=e.charAt(b.offset),l(b,1)):(d=null,0===m&&h("[a-zA-Z 0-9]"));else f=null;null!==f?(93===e.charCodeAt(b.offset)?(d="]",l(b,1)):(d=null,0===m&&h('"]"')),null!==d?a=[a,f,d]:(a=null,b=c(k))):(a=null,b=c(k))}else a=null,b=c(k);null!==a&&(a=a[1].join(""));null===a&&(b=c(g));return a}function B(){var a,f,d,g,k;m++;g=c(b);/^[0-9]/.test(e.charAt(b.offset))?(f=e.charAt(b.offset),l(b,1)):(f=null,0===m&&h("[0-9]"));if(null!==f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(e.charAt(b.offset))?(f=e.charAt(b.offset),
l(b,1)):(f=null,0===m&&h("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(b=c(g));if(null===a){g=c(b);k=c(b);45===e.charCodeAt(b.offset)?(a="-",l(b,1)):(a=null,0===m&&h('"-"'));if(null!==a){/^[0-9]/.test(e.charAt(b.offset))?(d=e.charAt(b.offset),l(b,1)):(d=null,0===m&&h("[0-9]"));if(null!==d)for(f=[];null!==d;)f.push(d),/^[0-9]/.test(e.charAt(b.offset))?(d=e.charAt(b.offset),l(b,1)):(d=null,0===m&&h("[0-9]"));else f=null;null!==f?a=[a,f]:(a=null,b=c(k))}else a=null,b=c(k);null!==
a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(b=c(g))}m--;0===m&&null===a&&h("integer");return a}function D(a){a.sort();for(var b=null,c=[],g=0;g<a.length;g++)a[g]!==b&&(c.push(a[g]),b=a[g]);return c}var r={dicerolls:s,diceroll:z,rollmode:q,minmax:p,operation:A,ws:t,intval:w,variable:x,integer:B};if(void 0!==n){if(void 0===r[n])throw Error("Invalid rule name: "+u(n)+".");}else n="dicerolls";var b={offset:0,line:1,column:1,seenCR:!1},m=0,v={offset:0,line:1,column:1,seenCR:!1},y=[],r=r[n]();if(null===
r||b.offset!==e.length){var r=Math.max(b.offset,v.offset),E=r<e.length?e.charAt(r):null,C=b.offset>v.offset?b:v;throw new this.SyntaxError(D(y),E,r,C.line,C.column);}return r},toSource:function(){return this._source},SyntaxError:function(e,n,c,l,h){this.name="SyntaxError";this.expected=e;this.found=n;switch(e.length){case 0:e="end of input";break;case 1:e=e[0];break;default:e=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}n=n?u(n):"end of input";this.message="Expected "+e+" but "+n+" found.";
this.offset=c;this.line=l;this.column=h}};p.SyntaxError.prototype=Error.prototype;return p}();
dice.eval=function(){var u=function(c,e){return c+e},p=function(c){1==c.min&&(c.min=function(){return 1});1==c.x&&(c.x=function(){return 1});return c},e=function(c,e){if(_.contains(["+","-","*","/"],e))return c.mode=e,c;var h=n(e,c.scope),s=h.reduce(u);c.rolls=c.rolls.concat(h);"+"==c.mode?c.sum+=s:"-"==c.mode?c.sum-=s:"*"==c.mode?c.sum*=s:"/"==c.mode&&(c.sum/=s);return c},n=function(c,e){c=p(c);return _.range(0,c.x(e)).map(function(){var h;h=c.min(e);var n=c.max(e),p=c.mode;if(h==n)h=n;else{var q=
_.random(h,n);if("d"==p)h=q;else{for(p=q;q==n;)q=_.random(h,n),p+=q;h=p}}return h})};return{eval:function(c,l){l=l||{};var h=c;h instanceof Array||(h=[h]);c=_.flatten(h);h=c.reduce(e,{sum:0,mode:"+",rolls:[],scope:l});return{sum:h.sum,rolls:h.rolls}}}}();
