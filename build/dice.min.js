dice={version:"0.3.0",roll:function(r,k){var d=dice.parse.parse(r);return dice.eval.eval(d,k)}};
dice.parse=function(){function r(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var k={parse:function(d,g){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function e(a,b){for(var c=a.offset+b,l=a.offset;l<c;l++){var h=d.charAt(l);"\n"===h?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===h||"\u2028"===h||"\u2029"===
h?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=b}function k(a){b.offset<s.offset||(b.offset>s.offset&&(s=c(b),w=[]),w.push(a))}function x(){var a,f,n,l,h;l=c(b);h=c(b);a=p();null!==a?(42===d.charCodeAt(b.offset)?(f="*",e(b,1)):(f=null,0===m&&k('"*"')),null!==f?(n=p(),null!==n?a=[a,f,n]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a="*");null===a&&(b=c(l));null===a&&(l=c(b),h=c(b),a=p(),null!==a?(47===d.charCodeAt(b.offset)?(f="/",e(b,1)):(f=null,0===m&&k('"/"')),
null!==f?(n=p(),null!==n?a=[a,f,n]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a="/"),null===a&&(b=c(l)));return a}function y(){var a,f,d,l,h;l=c(b);h=c(b);a=t();null!==a?(f=x(),null!==f?(d=y(),null!==d?a=[a,f,d]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(l));null===a&&(l=c(b),a=t(),null===a&&(b=c(l)));return a}function t(){var a,f,d,l,h;l=c(b);h=c(b);a=z();null!==a?(f=C(),null!==f?(d=t(),null!==d?a=[a,f,d]:(a=null,b=
c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(l));null===a&&(l=c(b),a=z(),null===a&&(b=c(l)));return a}function C(){var a,f,n,l,h;l=c(b);h=c(b);a=p();null!==a?(43===d.charCodeAt(b.offset)?(f="+",e(b,1)):(f=null,0===m&&k('"+"')),null!==f?(n=p(),null!==n?a=[a,f,n]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a="+");null===a&&(b=c(l));null===a&&(l=c(b),h=c(b),a=p(),null!==a?(45===d.charCodeAt(b.offset)?(f="-",e(b,1)):(f=null,0===m&&k('"-"')),
null!==f?(n=p(),null!==n?a=[a,f,n]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a="-"),null===a&&(b=c(l)));return a}function z(){var a,f,d,l,h;l=c(b);h=c(b);a=u();null!==a?(f=A(),null!==f?(d=v(),null!==d?a=[a,f,d]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(l));null===a&&(l=c(b),h=c(b),a=A(),null!==a?(f=v(),null!==f?a=[a,f]:(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a={op:a[0],args:[1,a[1]]}),null===a&&(b=c(l)),null===
a&&(l=c(b),a=u(),null===a&&(b=c(l)),null===a&&(l=c(b),a=v(),null!==a&&(a={op:"d",args:[1,a]}),null===a&&(b=c(l)))));return a}function A(){var a;100===d.charCodeAt(b.offset)?(a="d",e(b,1)):(a=null,0===m&&k('"d"'));null===a&&(119===d.charCodeAt(b.offset)?(a="w",e(b,1)):(a=null,0===m&&k('"w"')));return a}function v(){var a,f,n,l,h;l=c(b);h=c(b);a=u();null!==a?(".."===d.substr(b.offset,2)?(f="..",e(b,2)):(f=null,0===m&&k('".."')),null!==f?(n=u(),null!==n?a=[a,f,n]:(a=null,b=c(h))):(a=null,b=c(h))):(a=
null,b=c(h));null!==a&&(a={op:"random",args:[a[0],a[2]]});null===a&&(b=c(l));null===a&&(l=c(b),a=u(),null!==a&&(a={op:"random",args:[1,a]}),null===a&&(b=c(l)));return a}function p(){var a,c;a=[];/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),e(b,1)):(c=null,0===m&&k("[ ]"));for(;null!==c;)a.push(c),/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),e(b,1)):(c=null,0===m&&k("[ ]"));return a}function u(){var a,d,e,l;e=c(b);a=D();null!==a&&(a={op:"static",value:a});null===a&&(b=c(e));null===
a&&(e=c(b),a=B(),null===a&&(b=c(e)),null===a&&(e=c(b),l=c(b),a=E(),null!==a?(d=B(),null!==d?a=[a,d]:(a=null,b=c(l))):(a=null,b=c(l)),null!==a&&(a={op:a[0],args:[a[1]]}),null===a&&(b=c(e))));return a}function E(){var a,f;f=c(b);102===d.charCodeAt(b.offset)?(a="f",e(b,1)):(a=null,0===m&&k('"f"'));null!==a&&(a="floor");null===a&&(b=c(f));null===a&&(f=c(b),114===d.charCodeAt(b.offset)?(a="r",e(b,1)):(a=null,0===m&&k('"r"')),null!==a&&(a="round"),null===a&&(b=c(f)),null===a&&(f=c(b),99===d.charCodeAt(b.offset)?
(a="c",e(b,1)):(a=null,0===m&&k('"c"')),null!==a&&(a="ceil"),null===a&&(b=c(f))));return a}function B(){var a,d;d=c(b);a=F();null!==a&&(a={op:"lookup",args:[a]});null===a&&(b=c(d));return a}function F(){var a,f,g,l,h;l=c(b);h=c(b);91===d.charCodeAt(b.offset)?(a="[",e(b,1)):(a=null,0===m&&k('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),e(b,1)):(g=null,0===m&&k("[a-zA-Z 0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=
d.charAt(b.offset),e(b,1)):(g=null,0===m&&k("[a-zA-Z 0-9]"));else f=null;null!==f?(93===d.charCodeAt(b.offset)?(g="]",e(b,1)):(g=null,0===m&&k('"]"')),null!==g?a=[a,f,g]:(a=null,b=c(h))):(a=null,b=c(h))}else a=null,b=c(h);null!==a&&(a=a[1].join(""));null===a&&(b=c(l));return a}function D(){var a,f,g,l,h;m++;l=c(b);/^[0-9]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),e(b,1)):(f=null,0===m&&k("[0-9]"));if(null!==f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),
e(b,1)):(f=null,0===m&&k("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(b=c(l));if(null===a){l=c(b);h=c(b);45===d.charCodeAt(b.offset)?(a="-",e(b,1)):(a=null,0===m&&k('"-"'));if(null!==a){/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),e(b,1)):(g=null,0===m&&k("[0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),e(b,1)):(g=null,0===m&&k("[0-9]"));else f=null;null!==f?a=[a,f]:(a=null,b=c(h))}else a=null,b=c(h);null!==
a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(b=c(l))}m--;0===m&&null===a&&k("integer");return a}function H(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var q={dicerolls:function(){var a,d,g,e,h;e=c(b);h=c(b);a=t();null!==a?(d=x(),null!==d?(g=y(),null!==g?a=[a,d,g]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={op:a[1],args:[a[0],a[2]]});null===a&&(b=c(e));null===a&&(e=c(b),a=t(),null===a&&(b=c(e)));return a},multiplicationOp:x,multiplicationSeq:y,
additionSeq:t,additionOp:C,diceroll:z,rollmode:A,minmax:v,ws:p,intval:u,mathit:E,lookup:B,variable:F,integer:D};if(void 0!==g){if(void 0===q[g])throw Error("Invalid rule name: "+r(g)+".");}else g="dicerolls";var b={offset:0,line:1,column:1,seenCR:!1},m=0,s={offset:0,line:1,column:1,seenCR:!1},w=[],q=q[g]();if(null===q||b.offset!==d.length){var q=Math.max(b.offset,s.offset),I=q<d.length?d.charAt(q):null,G=b.offset>s.offset?b:s;throw new this.SyntaxError(H(w),I,q,G.line,G.column);}return q},toSource:function(){return this._source},
SyntaxError:function(d,g,c,e,k){this.name="SyntaxError";this.expected=d;this.found=g;switch(d.length){case 0:d="end of input";break;case 1:d=d[0];break;default:d=d.slice(0,d.length-1).join(", ")+" or "+d[d.length-1]}g=g?r(g):"end of input";this.message="Expected "+d+" but "+g+" found.";this.offset=c;this.line=e;this.column=k}};k.SyntaxError.prototype=Error.prototype;return k}();
dice.eval=function(){var r={"static":function(){var k=this.value;return function(){return k}},lookup:function(k){return function(d){return d[k]}},floor:function(k){return function(d){return Math.floor(k(d))}},ceil:function(k){return function(d){return Math.ceil(k(d))}},round:function(k){return function(d){return Math.round(k(d))}},d:function(k,d){return function(g){var c=([][k(g)-1]=!0).map(function(){return d(g)}),e=c.reduce(function(c,d){return c+d},0),e=new Number(e);e.rolls=c;return e}},w:function(k,
d){return function(g){var c=([][k(g)-1]=!0).map(function(){var c=d(g),e=0;if(d.min===d.max)return c;for(;c===d.max;)e+=c,c=mimMax(g);return e}),e=c.reduce(function(c,d){return c+d},0),e=new Number(e);e.rolls=c;return e}},"+":function(k,d){return function(g){var c=k(g);g=d(g);var e;e=new Number(c+g);e.op="+";e.rightSide=c;e.leftSide=g;return e}},"-":function(k,d){return function(g){var c=k(g);g=d(g);var e;e=new Number(c-g);e.op="-";e.rightSide=c;e.leftSide=g;return e}},"*":function(k,d){return function(d){var c=
k(d);d=k(d);var e;e=new Number(c*d);e.op="*";e.rightSide=c;e.leftSide=d;return e}},"/":function(k,d){return function(d){var c=k(d);d=k(d);var e;e=new Number(c/d);e.op="/";e.rightSide=c;e.leftSide=d;return e}}};return{eval:function(k,d){d=d||{};var g=k,c=g.args.map(resovle_op);r[g.op].apply(g,c);k=simplifyParsed(k);g=k.reduce(reduceThemBones,{sum:0,mode:"+",rolls:[],scope:d});return{sum:g.sum,rolls:g.rolls}}}}();
