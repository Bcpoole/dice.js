dice={roll:function(s,k){var d=dice.parse.parse(s);return dice.eval.eval(d,k)}};
dice.parse=function(){function s(d){return'"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var k={parse:function(d,l){function c(a){var b={},c;for(c in a)b[c]=a[c];return b}function h(a,b){for(var c=a.offset+b,m=a.offset;m<c;m++){var e=d.charAt(m);"\n"===e?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===e||"\u2028"===e||"\u2029"===
e?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=b}function e(a){b.offset<t.offset||(b.offset>t.offset&&(t=c(b),v=[]),v.push(a))}function y(){var a,f,g,d;d=c(b);a=w();null!==a?(f=z(),null!==f?(g=y(),null!==g?a=[a,f,g]:(a=null,b=c(d))):(a=null,b=c(d))):(a=null,b=c(d));null===a&&(a=w());return a}function w(){var a,f,d,e,h;e=c(b);h=c(b);a=u();null!==a?(f=q(),null!==f?(d=k(),null!==d?a=[a,f,d]:(a=null,b=c(h))):(a=null,b=c(h))):(a=null,b=c(h));null!==a&&(a={x:a[0],mode:a[1],min:a[2].min,
max:a[2].max});null===a&&(b=c(e));null===a&&(e=c(b),h=c(b),a=q(),null!==a?(f=k(),null!==f?a=[a,f]:(a=null,b=c(h))):(a=null,b=c(h)),null!==a&&(a={x:1,mode:a[0],min:a[1].min,max:a[1].max}),null===a&&(b=c(e)),null===a&&(e=c(b),a=u(),null!==a&&(a={x:1,mode:"d",min:a,max:a}),null===a&&(b=c(e)),null===a&&(e=c(b),a=k(),null!==a&&(a={x:1,mode:"d",min:a.min,max:a.max}),null===a&&(b=c(e)))));return a}function q(){var a;100===d.charCodeAt(b.offset)?(a="d",h(b,1)):(a=null,0===p&&e('"d"'));null===a&&(119===d.charCodeAt(b.offset)?
(a="w",h(b,1)):(a=null,0===p&&e('"w"')));return a}function k(){var a,f,g,m,n;m=c(b);n=c(b);a=u();null!==a?(".."===d.substr(b.offset,2)?(f="..",h(b,2)):(f=null,0===p&&e('".."')),null!==f?(g=u(),null!==g?a=[a,f,g]:(a=null,b=c(n))):(a=null,b=c(n))):(a=null,b=c(n));null!==a&&(a={min:a[0],max:a[2]});null===a&&(b=c(m));null===a&&(m=c(b),a=u(),null!==a&&(a={min:1,max:a}),null===a&&(b=c(m)));return a}function z(){var a,f,g,m,n;m=c(b);n=c(b);a=x();null!==a?(/^[+\-]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),
h(b,1)):(f=null,0===p&&e("[+\\-]")),null!==f?(g=x(),null!==g?a=[a,f,g]:(a=null,b=c(n))):(a=null,b=c(n))):(a=null,b=c(n));null!==a&&(a=a[1]);null===a&&(b=c(m));return a}function x(){var a,c;a=[];/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),h(b,1)):(c=null,0===p&&e("[ ]"));for(;null!==c;)a.push(c),/^[ ]/.test(d.charAt(b.offset))?(c=d.charAt(b.offset),h(b,1)):(c=null,0===p&&e("[ ]"));return a}function u(){var a,d;d=c(b);a=A();null!==a&&(a=function(a,b,c,d){a=function(){return d};a.static=!0;
return a}(d.offset,d.line,d.column,a));null===a&&(b=c(d));null===a&&(d=c(b),a=B(),null!==a&&(a=function(a,b,c,d){a=function(a){return a[d]};a.static=!1;a.variable=d;return a}(d.offset,d.line,d.column,a)),null===a&&(b=c(d)));return a}function B(){var a,f,g,m,n;m=c(b);n=c(b);91===d.charCodeAt(b.offset)?(a="[",h(b,1)):(a=null,0===p&&e('"["'));if(null!==a){/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),h(b,1)):(g=null,0===p&&e("[a-zA-Z 0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),
/^[a-zA-Z 0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),h(b,1)):(g=null,0===p&&e("[a-zA-Z 0-9]"));else f=null;null!==f?(93===d.charCodeAt(b.offset)?(g="]",h(b,1)):(g=null,0===p&&e('"]"')),null!==g?a=[a,f,g]:(a=null,b=c(n))):(a=null,b=c(n))}else a=null,b=c(n);null!==a&&(a=a[1].join(""));null===a&&(b=c(m));return a}function A(){var a,f,g,m,n;p++;m=c(b);/^[0-9]/.test(d.charAt(b.offset))?(f=d.charAt(b.offset),h(b,1)):(f=null,0===p&&e("[0-9]"));if(null!==f)for(a=[];null!==f;)a.push(f),/^[0-9]/.test(d.charAt(b.offset))?
(f=d.charAt(b.offset),h(b,1)):(f=null,0===p&&e("[0-9]"));else a=null;null!==a&&(a=parseInt(a.join(""),10));null===a&&(b=c(m));if(null===a){m=c(b);n=c(b);45===d.charCodeAt(b.offset)?(a="-",h(b,1)):(a=null,0===p&&e('"-"'));if(null!==a){/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),h(b,1)):(g=null,0===p&&e("[0-9]"));if(null!==g)for(f=[];null!==g;)f.push(g),/^[0-9]/.test(d.charAt(b.offset))?(g=d.charAt(b.offset),h(b,1)):(g=null,0===p&&e("[0-9]"));else f=null;null!==f?a=[a,f]:(a=null,b=c(n))}else a=
null,b=c(n);null!==a&&(a=-1*parseInt(a[1].join(""),10));null===a&&(b=c(m))}p--;0===p&&null===a&&e("integer");return a}function D(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var r={dicerolls:y,diceroll:w,rollmode:q,minmax:k,operation:z,ws:x,intval:u,variable:B,integer:A};if(void 0!==l){if(void 0===r[l])throw Error("Invalid rule name: "+s(l)+".");}else l="dicerolls";var b={offset:0,line:1,column:1,seenCR:!1},p=0,t={offset:0,line:1,column:1,seenCR:!1},
v=[],r=r[l]();if(null===r||b.offset!==d.length){var r=Math.max(b.offset,t.offset),E=r<d.length?d.charAt(r):null,C=b.offset>t.offset?b:t;throw new this.SyntaxError(D(v),E,r,C.line,C.column);}return r},toSource:function(){return this._source},SyntaxError:function(d,l,c,h,e){this.name="SyntaxError";this.expected=d;this.found=l;switch(d.length){case 0:d="end of input";break;case 1:d=d[0];break;default:d=d.slice(0,d.length-1).join(", ")+" or "+d[d.length-1]}l=l?s(l):"end of input";this.message="Expected "+
d+" but "+l+" found.";this.offset=c;this.line=h;this.column=e}};k.SyntaxError.prototype=Error.prototype;return k}();
dice.eval=function(){var s=function(c,d){return c+d},k=function(c){1==c.min&&(c.min=function(){return 1});1==c.x&&(c.x=function(){return 1});return c},d=function(c,d){if("+"==d||"-"==d)return c.mode=d,c;var e=l(d,c.scope),k=e.reduce(s);c.rolls=c.rolls.concat(e);"+"==c.mode?c.sum+=k:"-"==c.mode&&(c.sum-=k);return c},l=function(c,d){c=k(c);return _.range(0,c.x(d)).map(function(){var e;e=c.min(d);var k=c.max(d),l=c.mode;if(e==k)e=k;else{var q=_.random(e,k);if("d"==l)e=q;else{for(l=q;q==k;)q=_.random(e,
k),l+=q;e=l}}return e})};return{eval:function(c,h){h=h||{};var e=c;e instanceof Array||(e=[e]);c=_.flatten(e);e=c.reduce(d,{sum:0,mode:"+",rolls:[],scope:h});return{sum:e.sum,rolls:e.rolls}}}}();
